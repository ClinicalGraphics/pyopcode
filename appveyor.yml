environment:
  matrix:
    # http://www.appveyor.com/docs/installed-software#python
    - PYTHON: C:\Miniconda-x64
      CONDA_PY: 27
      CONDA_NPY: 111

    - PYTHON: C:\Miniconda35-x64
      CONDA_PY: 35
      CONDA_NPY: 111

platform:
  - x64

install:
  # we have to prepend the conda python to the path
  # and that would make it too long, so we redefine the whole thing here
  - set PATH=%PYTHON%;%PYTHON%\Scripts;%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;
  - set PATH=%PATH%;%SYSTEMROOT%\System32\WindowsPowerShell\v1.0\;C:\Program Files\Mercurial;
  - set PATH=%PATH%;C:\Program Files\7-Zip;C:\Program Files\AppVeyor\BuildAgent;

  # make sure conda is up to date and configured
  - conda update conda --yes --quiet
  - conda config --set show_channel_urls True --set always_yes True

  # Install the necessary packages
  - conda install conda-build=1.21.0 jinja2 anaconda-client --quiet
  # Show us the conda configuration we have right now
  - conda info -a
  # If this needs any private packages, we'll have to be more creative
  - conda env create --quiet

# See https://github.com/scikit-learn/scikit-learn/blob/master/appveyor.yml for inspiration
build_script:
  # There are so many dependencies for the invoke commands that it's easier to use the environment
  - activate pyopcode
  # test in-place building
  - invoke build -i
  # run test suite
  - invoke test
  # clean up
  - git clean -xdf
  # test the package build (which includes a test suite run on the package)
  - invoke build
